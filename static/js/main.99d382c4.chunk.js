(this["webpackJsonpimage-editor"]=this["webpackJsonpimage-editor"]||[]).push([[0],{132:function(e,t){},133:function(e,t){},134:function(e,t){},137:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(65),r=n.n(o),c=n(32),s=n(2),l=n(17),u=(n(49),n(7)),d=n(8),h=n(22),m=n(21),p=n(43),v=n.n(p),f=n(6),g=n(150),b=!1;try{var w={get passive(){return b=!0}};window.addEventListener("test",w,w),window.removeEventListener("test",w,w)}catch(B){b=!1}var y=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).rootDiv=void 0,a.onKeyUp=void 0,a.onKeyDown=void 0,a.onUnmount=void 0,a.rootDiv=i.a.createRef(),a.onKeyDown=e.onDown,a.onKeyUp=e.onUp,a.onUnmount=e.onUnmount,a}return Object(d.a)(n,[{key:"addEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.addEventListener(e,t,!!b&&{passive:!1})}},{key:"removeEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.removeEventListener(e,t)}},{key:"componentDidMount",value:function(){var e=this;document.onkeydown=function(t){return E(t,e.onKeyDown)},document.onkeyup=function(t){return E(t,e.onKeyUp)},this.addEventListener("touchstart",this.onKeyDown),this.addEventListener("touchend",this.onKeyUp),this.addEventListener("mousedown",this.onKeyDown),this.addEventListener("mouseup",this.onKeyUp)}},{key:"componentWillUnmount",value:function(){document.onkeydown=null,document.onkeyup=null,this.removeEventListener("touchstart",this.onKeyDown),this.removeEventListener("touchend",this.onKeyUp),this.removeEventListener("mousedown",this.onKeyDown),this.removeEventListener("mouseup",this.onKeyUp),this.onUnmount()}},{key:"render",value:function(){var e=this.props.clientState===f.ClientState.Connecting,t=this.props.clientState>=f.ClientState.Connected,n="Microphone ".concat(this.props.classNames),a=v()("Microphone__button",{hidden:!t,Microphone__button__active:this.props.clientState===f.ClientState.Recording,Microphone__button__inactive:this.props.clientState===f.ClientState.Stopping}),o=v()("Microphone__help","HelpText",{hidden:!t});return console.log("Client state: "+Object(f.stateToString)(this.props.clientState)),console.log(a),i.a.createElement("div",{className:n,ref:this.rootDiv},i.a.createElement("div",{style:{height:"50px"}}),e&&i.a.createElement(g.a,{size:"3vh",className:"Microphone__loading"}),i.a.createElement("div",{className:a},i.a.createElement("object",null,i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",tabIndex:0,viewBox:"-2 -2 24 24"},i.a.createElement("circle",{stroke:"#d8dfe6",strokeWidth:"0.5",cx:"10",cy:"10",r:"15",fill:"#ffffff"}),i.a.createElement("path",{d:"M10 10"}),i.a.createElement("path",{transform:"translate(2,2) scale(0.8)",x:"10",y:"10",d:"M9 18v-1.06A8 8 0 0 1 2 9h2a6 6 0 1 0 12 0h2a8 8 0 0 1-7 7.94V18h3v2H6v-2h3zM6 4a4 4 0 1 1 8 0v5a4 4 0 1 1-8 0V4z"})))),i.a.createElement("div",{className:o},"Press and hold space bar to talk"))}}]),n}(i.a.Component);function E(e,t){32===e.keyCode&&(e.preventDefault(),t(e))}var S=n(18),C={stopContext:function(e){},startContext:function(e){},intents:[],entities:[],brightness:0,recordButtonIsPressed:!1,isTapping:!1,clientState:f.ClientState.Disconnected,words:{},contextId:""},j=i.a.createContext(C),O=function(e){Object(h.a)(n,e);var t=Object(m.a)(n);function n(e){var a;Object(u.a)(this,n),(a=t.call(this,e)).browserClientStateChanged=function(e){a.setState(Object(S.a)({},a.state,{clientState:e}))},a.updateStateBySegmentChange=function(e){if(a.updateWords(e.words,e.contextId,e.id),e.isFinal){if(e.intent.intent.length>0){var t=e.intent;if("undo"===t.intent)a.props.imageEditor.undo();else if("add_filter"===t.intent){var n=e.entities.filter((function(e){return"filter"===e.type})),i={"old image":"sepia",classic:"sepia","black and white":"grayscale"};if(n.length>0&&n[0].value.toLowerCase()in i){var o=i[n[0].value.toLowerCase()];a.props.imageEditor.applyFilter(o)}}else if("increase"===t.intent)a.changeLuminosity(.2);else if("decrease"===t.intent)a.changeLuminosity(-.2);else if("move"===t.intent){var r=e.entities.filter((function(e){return"direction"===e.type}));if(r.length>0){var c=r[0].value.toLowerCase();a.props.imageEditor.moveFocus(c)}}else"crop"===t.intent&&a.props.imageEditor.zoomIn()}a.setState(Object(S.a)({},a.state,{clientState:a.state.clientState,brightness:a.state.brightness,contextId:a.state.contextId}))}},a.startContext=function(e){a.state.clientState!==f.ClientState.Disconnected?a.state.clientState===f.ClientState.Connected&&a.client.startContext((function(e){e&&console.error("Could not start recording",e)})):a.client.initialize((function(e){e&&console.error("Error initializing Speechly client:",e)}))},a.stopContext=function(e){a.toggleRecordButtonState(!1);var t=a.state,n=t.recordButtonIsPressedStarted,i=t.recordButtonIsPressedStopped;a.stopRecording(e),n&&i&&a.setState(Object(S.a)({},a.state,{isTapping:Boolean(i.getTime()-n.getTime()<1e3)}))},a.toggleRecordButtonState=function(e){a.setState(Object(S.a)({},a.state,{isTapping:!1,recordButtonIsPressed:e,recordButtonIsPressedStarted:e?new Date:a.state.recordButtonIsPressedStarted,recordButtonIsPressedStopped:e?a.state.recordButtonIsPressedStopped:new Date}))},a.stopRecording=function(e){a.state.clientState===f.ClientState.Recording&&a.client.stopContext((function(e){e&&console.error("Could not stop recording",e)}))},a.closeClient=function(){if(!(a.state.clientState<f.ClientState.Connected))try{a.client.close((function(e){void 0!==e&&console.error("Could not close client",e)}))}catch(B){console.error("Could not close client",B)}},a.updateWords=function(e,t,n){var i={};a.state.contextId===t&&(i=a.state.words);for(var o=0;o<e.length;o++)e[o]&&e[o].index&&(i[parseInt(e[o].index)]=e[o]);a.setState(Object(S.a)({},a.state,{words:i,contextId:t}));var r=a.props.transcriptDiv;if(i){var c=Object.keys(i).map((function(e){return parseInt(e)})).sort().map((function(e){return i[e].isFinal?"<b>".concat(i[e].value,"</b>"):i[e].value})).join(" ");r.innerHTML=c}};var i={appId:a.props.appId,language:a.props.language};return console.log("Initializing client",i),a.client=new f.Client(i),a.client.onSegmentChange(a.updateStateBySegmentChange),a.client.onStateChange(a.browserClientStateChanged),a.state=C,a}return Object(d.a)(n,[{key:"changeLuminosity",value:function(e){var t=this.state.brightness+e;this.setState(Object(S.a)({},this.state,{clientState:this.state.clientState,brightness:t})),this.props.imageEditor.applyFilter("brightness",{brightness:t})}},{key:"render",value:function(){return i.a.createElement(j.Provider,{value:Object(S.a)({},this.state,{startContext:this.startContext,stopContext:this.stopContext,closeClient:this.closeClient})},this.props.children)}}]),n}(a.Component),k=j,x=n(11),L=function(e,t){var n,a=e.height||1e3,i=e.width||1e3,o=a/i,r=window.innerHeight/window.innerWidth,c=document.getElementsByClassName("canvas-container")[0];if(o<r){var s=.7*window.innerWidth,l=s*o*.7,u=s/i,d=l/a;n=e.set({left:0,top:(window.innerHeight-l)/10,scaleX:u,scaleY:d}),c.style.height="".concat(l,"px")}else{var h=window.innerWidth*r/o*.7,m=.7*window.innerHeight,p=h/i,v=m/a;n=e.set({left:(window.innerWidth-h)/2,top:0,scaleX:p,scaleY:v}),c.style.height="".concat(m,"px")}return n},I=function(){function e(t,n){var a=this;Object(u.a)(this,e),this.editorHTMLDiv=void 0,this.imageUrl=void 0,this.canvas=void 0,this.htmlCanvas=void 0,this.operationStack=void 0,this.imageObject=void 0,this.resize=function(){var e=window.innerWidth,t=window.innerHeight;a.htmlCanvas.width=e,a.htmlCanvas.height=t,a.htmlCanvas.style.width="".concat(e,"px"),a.htmlCanvas.style.height="".concat(t,"px - 60px")},this.editorHTMLDiv=t,this.imageUrl=n,this.htmlCanvas=document.createElement("canvas"),this.htmlCanvas.id="canvas",this.resize(),this.editorHTMLDiv.appendChild(this.htmlCanvas),x.fabric.Object.prototype.transparentCorners=!1;var i=new x.fabric.Canvas(this.htmlCanvas);this.canvas=i,this.imageObject=new x.fabric.Image;var o=this;x.fabric.Image.fromURL(n,(function(e){if(e){o.imageObject=e;var t=L(e);o.canvas.add(t)}})),this.operationStack=[]}return Object(d.a)(e,[{key:"applyFilter",value:function(e,t){var n=x.fabric.Image.filters,a={grayscale:n.Grayscale,sepia:n.Sepia,brightness:n.Brightness,crop:n.Resize};if(e in a){var i,o=t?new a[e](t):new a[e];this.operationStack.push({type:"filter",operation:o}),null===(i=this.imageObject.filters)||void 0===i||i.push(o),this.imageObject.applyFilters(),this.canvas.renderAll()}}},{key:"zoomIn",value:function(){this.operationStack.push({type:"zoom",operation:.2});var e=1+this.operationStack.filter((function(e){return"zoom"===e.type})).map((function(e){return e.operation})).reduce((function(e,t){return e+t})),t=window.innerHeight/2,n=window.innerWidth/2;this.canvas.zoomToPoint(new x.fabric.Point(n,t),e)}},{key:"moveFocus",value:function(e){console.log(e);var t=0,n=0;switch(e){case"left":t=200;break;case"right":t=-200;break;case"up":n=200;break;case"down":n=-200}this.operationStack.push({type:"move",operation:{moveX:t,moveY:n}});var a=new x.fabric.Point(t,n);this.canvas.relativePan(a)}},{key:"undo",value:function(){if(this.operationStack.length>0){this.operationStack.pop();var e=this;this.canvas.clear(),x.fabric.Image.fromURL(this.imageUrl,(function(t){if(t){e.imageObject=t;var n=L(t,e.canvas),a=1;if(e.operationStack.length>0){t.filters=e.operationStack.filter((function(e){return"filter"===e.type})).map((function(e){return e.operation})),t.applyFilters();var i=e.operationStack.filter((function(e){return"zoom"===e.type})).map((function(e){return e.operation}));i.length>0&&(a+=i.reduce((function(e,t){return e+t})));var o=e.operationStack.filter((function(e){return"move"===e.type})).map((function(e){return e.operation}));if(o.length>0){var r=o.reduce((function(e,t){return e.moveX+t.moveX})).moveX,c=o.reduce((function(e,t){return e.moveY+t.moveY})).moveY,s=new x.fabric.Point(r,c);e.canvas.relativePan(s)}}var l=window.innerHeight/2,u=window.innerWidth/2;e.canvas.zoomToPoint(new x.fabric.Point(u,l),a),e.canvas.add(n)}}))}}}]),e}();var P=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null),o=Object(a.useState)(),r=Object(l.a)(o,2),c=r[0],s=r[1],u=Object(a.useState)(),d=Object(l.a)(u,2),h=d[0],m=d[1],p="1648fbe6-5c0b-4fca-a962-1bb42a4c4437";Object(a.useEffect)((function(){if(e.location){var t=e.location.imgPath;if(t){var n={imgPath:t};localStorage.setItem("Speechly-image-editor-imagePath",JSON.stringify(n))}else{var a=localStorage.getItem("Speechly-image-editor-imagePath");t=JSON.parse(a).imgPath}m(t)}}),[e.location]);var v=function(){var e=Object(a.useState)([0,0]),t=Object(l.a)(e,2),n=t[0],i=t[1];return Object(a.useLayoutEffect)((function(){function e(){i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),f=Object(l.a)(v,2),g=f[0],b=f[1];return Object(a.useEffect)((function(){if(!c&&h){var e=new I(t.current,h);s(e)}}),[t,h,g,b,c]),i.a.createElement("div",{style:{width:g,height:Math.min(b,500)}},i.a.createElement("section",{className:"photo"},i.a.createElement("div",{ref:t})),i.a.createElement("section",{className:"app"},i.a.createElement("div",{ref:n})),i.a.createElement("section",{className:"controls"},i.a.createElement(O,{appId:p,language:"en-US",imageEditor:c,transcriptDiv:n.current},i.a.createElement(k.Consumer,null,(function(e){var t=e.stopContext,n=e.startContext,a=e.closeClient,o=e.clientState;return i.a.createElement("div",null,i.a.createElement(y,{onUp:t,onDown:n,onUnmount:a,clientState:o,classNames:"Playground__mic"}),i.a.createElement("section",{className:"app"},i.a.createElement("i",null,i.a.createElement("b",null,"Try out these:")),i.a.createElement("ul",null,i.a.createElement("li",null,"make it black and white"),i.a.createElement("li",null,"make it classic"),i.a.createElement("li",null,"increase the light"),i.a.createElement("li",null,"magnify one step"),i.a.createElement("li",null,"move the focus up"),i.a.createElement("li",null,"move the focus down"))))})))," */"))},D=n(70),U=n(69),N=n.n(U),z=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)({imgPath:["/photo-editor-demo/images/microphone_smaller.jpg"]}),s=Object(l.a)(r,2),u=s[0],d=s[1],h=Object(a.useRef)(null),m=n?"btn":"btn btn-disabled",p={pathname:"/edit/",imgPath:u.imgPath.slice(-1)[0]};return i.a.createElement("div",null,i.a.createElement("section",{className:"app intro"},i.a.createElement("img",{className:"logo",src:N.a,alt:""}),i.a.createElement("section",{className:"onboarding"},i.a.createElement("h1",null,"Use speech to edit and apply filters for your  photos and images"),i.a.createElement("section",{className:"gallery"},u.imgPath.map((function(e,t){return i.a.createElement("section",{className:"thumbnail",key:t},i.a.createElement("img",{src:e,alt:""}))})),i.a.createElement("section",{className:"upload upload-btn-wrapper"},i.a.createElement("button",{className:"upload-btn"},"Upload"),i.a.createElement("input",{type:"file",name:"myfile",ref:h,onChange:function(){var e;if(null===(e=h.current)||void 0===e?void 0:e.files){var t=h.current.files[0];d({imgPath:[].concat(Object(D.a)(u.imgPath),[URL.createObjectURL(t)])})}}}))),i.a.createElement("section",{className:"formRow"},i.a.createElement("input",{type:"checkbox",name:"micro",id:"micro",value:"",checked:n,onChange:function(e){return o(e.target.checked)}}),i.a.createElement("label",{htmlFor:"micro"},"Allow Audio to control over voice")),i.a.createElement(c.b,{to:p,className:m},"Start editing"))))},_=function(){return i.a.createElement("div",null,i.a.createElement(c.a,null,i.a.createElement(s.c,null,i.a.createElement(s.a,{exact:!0,path:"/",component:z}),i.a.createElement(s.a,{exact:!0,path:"/edit",component:P}))))};r.a.render(i.a.createElement(_,null),document.getElementById("root"))},49:function(e,t,n){},69:function(e,t,n){e.exports=n.p+"static/media/logo.4ecbb0d2.png"},72:function(e,t,n){e.exports=n(137)}},[[72,1,2]]]);
//# sourceMappingURL=main.99d382c4.chunk.js.map