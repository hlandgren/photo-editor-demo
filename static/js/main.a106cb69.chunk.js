(this["webpackJsonpimage-editor"]=this["webpackJsonpimage-editor"]||[]).push([[0],{133:function(e,t){},134:function(e,t){},135:function(e,t){},138:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(65),r=n.n(o),c=n(32),s=n(2),l=n(17),u=(n(49),n(8)),d=n(11),m=n(22),h=n(21),p=n(43),g=n.n(p),v=n(7),f=n(151),b=!1;try{var y={get passive(){return b=!0}};window.addEventListener("test",y,y),window.removeEventListener("test",y,y)}catch(B){b=!1}var E=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(u.a)(this,n),(a=t.call(this,e)).rootDiv=void 0,a.onKeyUp=void 0,a.onKeyDown=void 0,a.onUnmount=void 0,a.rootDiv=i.a.createRef(),a.onKeyDown=e.onDown,a.onKeyUp=e.onUp,a.onUnmount=e.onUnmount,a}return Object(d.a)(n,[{key:"addEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.addEventListener(e,t,!!b&&{passive:!1})}},{key:"removeEventListener",value:function(e,t){null!==this.rootDiv.current&&this.rootDiv.current.removeEventListener(e,t)}},{key:"componentDidMount",value:function(){var e=this;document.onkeydown=function(t){return w(t,e.onKeyDown)},document.onkeyup=function(t){return w(t,e.onKeyUp)},this.addEventListener("touchstart",this.onKeyDown),this.addEventListener("touchend",this.onKeyUp),this.addEventListener("mousedown",this.onKeyDown),this.addEventListener("mouseup",this.onKeyUp)}},{key:"componentWillUnmount",value:function(){document.onkeydown=null,document.onkeyup=null,this.removeEventListener("touchstart",this.onKeyDown),this.removeEventListener("touchend",this.onKeyUp),this.removeEventListener("mousedown",this.onKeyDown),this.removeEventListener("mouseup",this.onKeyUp),this.onUnmount()}},{key:"render",value:function(){var e=this.props.clientState===v.ClientState.Connecting,t=this.props.clientState>=v.ClientState.Connected,n="Microphone ".concat(this.props.classNames),a=g()("Microphone__button",{hidden:!t,Microphone__button__active:this.props.clientState===v.ClientState.Recording,Microphone__button__inactive:this.props.clientState===v.ClientState.Stopping}),o=g()("Microphone__help","HelpText",{hidden:!t});return console.log("Client state: "+Object(v.stateToString)(this.props.clientState)),console.log(a),i.a.createElement("div",{className:n,ref:this.rootDiv},i.a.createElement("div",{style:{height:"50px"}}),e&&i.a.createElement(f.a,{size:"3vh",className:"Microphone__loading"}),i.a.createElement("div",{className:a},i.a.createElement("object",null,i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",tabIndex:0,viewBox:"-2 -2 24 24"},i.a.createElement("circle",{stroke:"#d8dfe6",strokeWidth:"0.5",cx:"10",cy:"10",r:"15",fill:"#ffffff"}),i.a.createElement("path",{d:"M10 10"}),i.a.createElement("path",{transform:"translate(2,2) scale(0.8)",x:"10",y:"10",d:"M9 18v-1.06A8 8 0 0 1 2 9h2a6 6 0 1 0 12 0h2a8 8 0 0 1-7 7.94V18h3v2H6v-2h3zM6 4a4 4 0 1 1 8 0v5a4 4 0 1 1-8 0V4z"})))),i.a.createElement("div",{className:o},"Press and hold space bar to talk"))}}]),n}(i.a.Component);function w(e,t){32===e.keyCode&&(e.preventDefault(),t(e))}var S=n(23),C={stopContext:function(e){},startContext:function(e){},recordButtonIsPressed:!1,isTapping:!1,clientState:v.ClientState.Disconnected,words:{},contextId:""},j=i.a.createContext(C),k=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var a;Object(u.a)(this,n),(a=t.call(this,e)).browserClientStateChanged=function(e){a.setState(Object(S.a)({},a.state,{clientState:e}))},a.updateStateBySegmentChange=function(e){if(a.updateWords(e.words,e.contextId,e.id),e.isFinal&&e.intent.intent.length>0){var t=e.intent;if("undo"===t.intent)a.props.imageEditor.undo();else if("add_filter"===t.intent){var n=a.collectEntity(e.entities,"filter");n in a.entity2canonical&&a.props.imageEditor.enableFilter(a.entity2canonical[n])}else if("remove_filter"===t.intent){var i=a.collectEntity(e.entities,"filter");i in a.entity2canonical&&a.props.imageEditor.disableFilter(a.entity2canonical[i])}else if("increase"===t.intent){var o=a.collectEntity(e.entities,"property");o in a.entity2canonical&&a.props.imageEditor.incrementProperty(a.entity2canonical[o])}else if("decrease"===t.intent){var r=a.collectEntity(e.entities,"property");r in a.entity2canonical&&a.props.imageEditor.decrementProperty(a.entity2canonical[r])}}},a.collectEntity=function(e,t){var n=e.filter((function(e){return e.type===t}));return n.length>0?n[0].value.toLowerCase():""},a.startContext=function(e){a.state.clientState!==v.ClientState.Disconnected?a.state.clientState===v.ClientState.Connected&&a.client.startContext((function(e){e&&console.error("Could not start recording",e)})):a.client.initialize((function(e){e&&console.error("Error initializing Speechly client:",e)}))},a.stopContext=function(e){a.toggleRecordButtonState(!1);var t=a.state,n=t.recordButtonIsPressedStarted,i=t.recordButtonIsPressedStopped;a.stopRecording(e),n&&i&&a.setState(Object(S.a)({},a.state,{isTapping:Boolean(i.getTime()-n.getTime()<1e3)}))},a.toggleRecordButtonState=function(e){a.setState(Object(S.a)({},a.state,{isTapping:!1,recordButtonIsPressed:e,recordButtonIsPressedStarted:e?new Date:a.state.recordButtonIsPressedStarted,recordButtonIsPressedStopped:e?a.state.recordButtonIsPressedStopped:new Date}))},a.stopRecording=function(e){a.state.clientState===v.ClientState.Recording&&a.client.stopContext((function(e){e&&console.error("Could not stop recording",e)}))},a.closeClient=function(){if(!(a.state.clientState<v.ClientState.Connected))try{a.client.close((function(e){void 0!==e&&console.error("Could not close client",e)}))}catch(B){console.error("Could not close client",B)}},a.updateWords=function(e,t,n){var i={};a.state.contextId===t&&(i=a.state.words);for(var o=0;o<e.length;o++)e[o]&&e[o].index&&(i[parseInt(e[o].index)]=e[o]);a.setState(Object(S.a)({},a.state,{words:i,contextId:t}));var r=a.props.transcriptDiv;if(i){var c=Object.keys(i).map((function(e){return parseInt(e)})).sort().map((function(e){return i[e].isFinal?"<b>".concat(i[e].value,"</b>"):i[e].value})).join(" ");r.innerHTML=c}};var i={appId:a.props.appId,language:a.props.language};return console.log("Initializing client",i),a.client=new v.Client(i),a.client.onSegmentChange(a.updateStateBySegmentChange),a.client.onStateChange(a.browserClientStateChanged),a.state=C,a.entity2canonical={sepia:"sepia",vintage:"vintage",classic:"vintage",faded:"sepia",grayscale:"grayscale","black and white":"grayscale",kodachrome:"kodachrome",technicolor:"technicolor",polaroid:"polaroid",luminosity:"brightness",brightness:"brightness",light:"brightness",contrast:"contrast",saturation:"saturation",color:"saturation"},a}return Object(d.a)(n,[{key:"render",value:function(){return i.a.createElement(j.Provider,{value:Object(S.a)({},this.state,{startContext:this.startContext,stopContext:this.stopContext,closeClient:this.closeClient})},this.props.children)}}]),n}(a.Component),O=j,x=n(69),I=n(5),P=function e(t,n){var a=this;Object(u.a)(this,e),this.editorHTMLDiv=void 0,this.imageUrl=void 0,this.canvas=void 0,this.htmlCanvas=void 0,this.operatorStack=void 0,this.imageObject=void 0,this.stepSize=new Map,this.incrementProperty=function(e){console.log("incrementProperty "+e);var t=a.stepSize.get(e);a.operatorStack.push({type:"property",name:e,value:t||0}),a.updateImage()},this.decrementProperty=function(e){console.log("decrementProperty "+e);var t=a.stepSize.get(e);a.operatorStack.push({type:"property",name:e,value:t?-1*t:0}),a.updateImage()},this.enableFilter=function(e){console.log("enableFilter "+e),a.operatorStack.push({type:"filter",name:e,value:1}),a.updateImage()},this.disableFilter=function(e){console.log("disableFilter "+e),a.operatorStack.push({type:"filter",name:e,value:0}),a.updateImage()},this.undo=function(){console.log("at undo"),a.operatorStack.pop(),a.updateImage()},this.updateImage=function(){console.log(a.operatorStack);var e=a.buildEditorState();if(console.log(e),a.imageObject.filters=[],0!==e.brightness){var t=new I.fabric.Image.filters.Brightness({brightness:e.brightness});a.imageObject.filters.push(t)}if(0!==e.contrast){var n=new I.fabric.Image.filters.Contrast({contrast:e.contrast});a.imageObject.filters.push(n)}if(0!==e.saturation){var i=new I.fabric.Image.filters.Saturation({saturation:e.saturation});a.imageObject.filters.push(i)}if(e.kodachrome>0){var o=a.makeKodachromeFilter();a.imageObject.filters.push(o)}if(e.vintage>0){var r=a.makeVintageFilter();a.imageObject.filters.push(r)}if(e.technicolor>0){var c=a.makeTechnicolorFilter();a.imageObject.filters.push(c)}if(e.polaroid>0){var s=a.makePolaroidFilter();a.imageObject.filters.push(s)}if(e.sepia>0){var l=new I.fabric.Image.filters.Sepia;a.imageObject.filters.push(l)}if(e.grayscale>0){var u=new I.fabric.Image.filters.Grayscale;a.imageObject.filters.push(u)}a.imageObject.applyFilters(),a.canvas.renderAll()},this.buildEditorState=function(){var e,t=a.cleanEditorState(),n=Object(x.a)(a.operatorStack);try{for(n.s();!(e=n.n()).done;){var i=e.value;"property"===i.type?t[i.name]+=i.value:"filter"===i.type&&(t[i.name]=i.value)}}catch(B){n.e(B)}finally{n.f()}return t},this.cleanEditorState=function(){return{brightness:0,contrast:0,saturation:0,grayscale:0,kodachrome:0,vintage:0,sepia:0,technicolor:0,polaroid:0}},this.resize=function(){var e=window.innerWidth,t=window.innerHeight;a.htmlCanvas.width=e,a.htmlCanvas.height=t,a.htmlCanvas.style.width="".concat(e,"px"),a.htmlCanvas.style.height="".concat(t,"px - 60px")},this.makeKodachromeFilter=function(){return console.log("at makeKodachromeFilter"),new I.fabric.Image.filters.ColorMatrix({matrix:[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0]})},this.makeVintageFilter=function(){return console.log("at makeVintageFilter"),new I.fabric.Image.filters.ColorMatrix({matrix:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]})},this.makeTechnicolorFilter=function(){return console.log("at makeTechnicolorFilter"),new I.fabric.Image.filters.ColorMatrix({matrix:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]})},this.makePolaroidFilter=function(){return console.log("at makePolaroidFilter"),new I.fabric.Image.filters.ColorMatrix({matrix:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]})},this.editorHTMLDiv=t,this.imageUrl=n,this.htmlCanvas=document.createElement("canvas"),this.htmlCanvas.id="canvas",this.resize(),this.editorHTMLDiv.appendChild(this.htmlCanvas),I.fabric.Object.prototype.transparentCorners=!1;var i=new I.fabric.Canvas(this.htmlCanvas);this.canvas=i,this.imageObject=new I.fabric.Image;var o=this;I.fabric.Image.fromURL(n,(function(e){if(e){o.imageObject=e;var t=D(e,i);o.canvas.add(t)}})),this.stepSize.set("brightness",.1),this.stepSize.set("contrast",.1),this.stepSize.set("saturation",.2),this.operatorStack=[]},D=function(e,t){var n,a=e.height||1e3,i=e.width||1e3,o=a/i,r=window.innerHeight/window.innerWidth,c=document.getElementsByClassName("canvas-container")[0];if(o<r){var s=.7*window.innerWidth,l=s*o*.7,u=s/i,d=l/a;n=e.set({left:0,top:(window.innerHeight-l)/10,scaleX:u,scaleY:d}),c.style.height="".concat(l,"px")}else{var m=window.innerWidth*r/o*.7,h=.7*window.innerHeight,p=m/i,g=h/a;n=e.set({left:(window.innerWidth-m)/2,top:0,scaleX:p,scaleY:g}),c.style.height="".concat(h,"px")}return n};var L=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null),o=Object(a.useState)(),r=Object(l.a)(o,2),c=r[0],s=r[1],u=Object(a.useState)(),d=Object(l.a)(u,2),m=d[0],h=d[1],p="3e3cbd21-ca45-4eed-9747-e5522a056cd2";Object(a.useEffect)((function(){if(e.location){var t=e.location.imgPath;if(t){var n={imgPath:t};localStorage.setItem("Speechly-image-editor-imagePath",JSON.stringify(n))}else{var a=localStorage.getItem("Speechly-image-editor-imagePath");t=JSON.parse(a).imgPath}h(t)}}),[e.location]);var g=function(){var e=Object(a.useState)([0,0]),t=Object(l.a)(e,2),n=t[0],i=t[1];return Object(a.useLayoutEffect)((function(){function e(){i([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}}),[]),n}(),v=Object(l.a)(g,2),f=v[0],b=v[1];return Object(a.useEffect)((function(){if(!c&&m){var e=new P(t.current,m);s(e)}}),[t,m,f,b,c]),i.a.createElement("div",{style:{width:f,height:Math.min(b,500)}},i.a.createElement("section",{className:"photo"},i.a.createElement("div",{ref:t})),i.a.createElement("section",{className:"app"},i.a.createElement("div",{ref:n})),i.a.createElement("section",{className:"controls"},i.a.createElement(k,{appId:p,language:"en-US",imageEditor:c,transcriptDiv:n.current},i.a.createElement(O.Consumer,null,(function(e){var t=e.stopContext,n=e.startContext,a=e.closeClient,o=e.clientState;return i.a.createElement("div",null,i.a.createElement(E,{onUp:t,onDown:n,onUnmount:a,clientState:o,classNames:"Playground__mic"}),i.a.createElement("section",{className:"app"},i.a.createElement("i",null,i.a.createElement("b",null,"Try out these:")),i.a.createElement("ul",null,i.a.createElement("li",null,"make it black and white"),i.a.createElement("li",null,"make it classic"),i.a.createElement("li",null,"increase the light"),i.a.createElement("li",null,"reduce the light"),i.a.createElement("li",null,"magnify little bit"),i.a.createElement("li",null,"make it black and white and reduce the light"),i.a.createElement("li",null,"increase the light and make it classic"))))})))))},U=n(71),F=n(70),N=n.n(F),M=function(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),n=t[0],o=t[1],r=Object(a.useState)({imgPath:["/photo-editor-demo/images/microphone_smaller.jpg"]}),s=Object(l.a)(r,2),u=s[0],d=s[1],m=Object(a.useRef)(null),h=n?"btn":"btn btn-disabled",p={pathname:"/edit/",imgPath:u.imgPath.slice(-1)[0]};return i.a.createElement("div",null,i.a.createElement("section",{className:"app intro"},i.a.createElement("img",{className:"logo",src:N.a,alt:""}),i.a.createElement("section",{className:"onboarding"},i.a.createElement("h1",null,"Use speech to edit and apply filters for your  photos and images"),i.a.createElement("section",{className:"gallery"},u.imgPath.map((function(e,t){return i.a.createElement("section",{className:"thumbnail",key:t},i.a.createElement("img",{src:e,alt:""}))})),i.a.createElement("section",{className:"upload upload-btn-wrapper"},i.a.createElement("button",{className:"upload-btn"},"Upload"),i.a.createElement("input",{type:"file",name:"myfile",ref:m,onChange:function(){var e;if(null===(e=m.current)||void 0===e?void 0:e.files){var t=m.current.files[0];d({imgPath:[].concat(Object(U.a)(u.imgPath),[URL.createObjectURL(t)])})}}}))),i.a.createElement("section",{className:"formRow"},i.a.createElement("input",{type:"checkbox",name:"micro",id:"micro",value:"",checked:n,onChange:function(e){return o(e.target.checked)}}),i.a.createElement("label",{htmlFor:"micro"},"Allow Audio to control over voice")),i.a.createElement(c.b,{to:p,className:h},"Start editing"))))},_=function(){return i.a.createElement("div",null,i.a.createElement(c.a,null,i.a.createElement(s.c,null,i.a.createElement(s.a,{exact:!0,path:"/",component:M}),i.a.createElement(s.a,{exact:!0,path:"/edit",component:L}))))};r.a.render(i.a.createElement(_,null),document.getElementById("root"))},49:function(e,t,n){},70:function(e,t,n){e.exports=n.p+"static/media/logo.4ecbb0d2.png"},73:function(e,t,n){e.exports=n(138)}},[[73,1,2]]]);
//# sourceMappingURL=main.a106cb69.chunk.js.map